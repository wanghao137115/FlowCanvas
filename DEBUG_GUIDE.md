# 形状文字编辑调试指南

## 调试信息说明

我已经在关键位置添加了详细的console.log调试信息，现在你可以通过浏览器的开发者工具控制台来查看输入框消失的原因。

## 调试步骤

### 1. 打开开发者工具
- 按 F12 或右键选择"检查"
- 切换到"Console"标签页

### 2. 双击形状元素
- 双击任何形状元素（矩形、圆形等）
- 观察控制台输出的调试信息

### 3. 关键调试信息

#### 双击检测
```
🖱️ 鼠标点击检测: {
  isDoubleClick: true/false,
  clickedElementType: "shape",
  clickedElementId: "element-id",
  timeDiff: 时间差,
  lastClickElementId: "上一个点击的元素ID"
}
```

#### 编辑开始
```
🎯 开始形状文字编辑 element-id
📝 创建形状文字输入框
✅ 输入框已添加到页面 {position: {...}, element: input, isInDOM: true}
🎯 输入框已聚焦
🔗 绑定输入框事件
```

#### 输入框事件
```
🖱️ 输入框点击事件
🖱️ 输入框鼠标按下事件
🖱️ 输入框鼠标抬起事件
⌨️ 键盘事件: 按键名称
👁️ 输入框失去焦点
```

#### 渲染控制
```
🚫 跳过渲染 - 正在编辑形状文字
🎨 鼠标移动后请求渲染
🎨 鼠标抬起后请求渲染
```

#### 编辑完成
```
✅ 完成编辑
🏁 完成形状文字编辑
📝 编辑的文字: "用户输入的文字"
🧹 编辑状态已清理
🗑️ 移除形状文字输入框
✅ 输入框从DOM中移除
```

## 可能的问题原因

### 1. 双击检测失败
如果看到 `isDoubleClick: false`，说明双击检测没有成功，可能原因：
- 双击时间间隔超过300ms
- 点击的不是同一个元素
- 元素ID不匹配

### 2. 输入框创建失败
如果看到输入框创建但立即消失，检查：
- `isInDOM: false` - 输入框没有正确添加到DOM
- 是否有其他代码移除了输入框

### 3. 事件冲突
如果看到多个事件同时触发：
- 检查是否有其他鼠标事件干扰
- 查看是否有意外的blur事件

### 4. 渲染干扰
如果看到渲染相关的日志：
- `🚫 跳过渲染` - 正常，表示渲染被正确跳过
- `🎨 重新渲染` - 异常，表示渲染没有被跳过

## 调试建议

1. **完整记录**：从双击开始到输入框消失，记录所有控制台输出
2. **时间顺序**：注意事件发生的时间顺序
3. **状态检查**：特别关注 `isEditingShapeText` 状态的变化
4. **DOM检查**：在Elements标签页中检查输入框是否真的存在

## 常见问题排查

### 问题1：双击检测失败
**现象**：没有看到 `🔷 双击形状元素` 日志
**解决**：检查双击时间间隔和元素ID匹配

### 问题2：输入框创建后立即消失
**现象**：看到创建日志但立即看到移除日志
**解决**：检查是否有其他代码调用了 `removeShapeTextInput()`

### 问题3：失去焦点导致编辑结束
**现象**：看到 `👁️ 输入框失去焦点` 后立即完成编辑
**解决**：检查是否有其他元素抢夺了焦点

请运行测试并将控制台的完整输出发给我，这样我就能准确定位问题所在。
