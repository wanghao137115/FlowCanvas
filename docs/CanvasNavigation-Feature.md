# 🗺️ 画布导航功能详细介绍

## 📋 功能概述

画布导航是一套帮助用户在大型画布中快速定位和导航的辅助工具系统。当画布内容很多、面积很大时，用户往往会"迷失"在画布中，不知道自己在画布的哪个位置，也不知道其他元素在哪里。画布导航系统通过**缩略图导航**、**画布概览**和**快速定位**三个核心功能，帮助用户：

- 🎯 **快速了解画布整体布局**
- 🔍 **快速定位到特定区域**
- 📍 **快速找到并跳转到特定元素**
- 🧭 **始终知道自己当前在画布的哪个位置**

---

## 🎨 一、缩略图导航（Mini-map / Thumbnail Navigation）

### 1.1 功能描述

缩略图导航是在画布右下角（或可拖拽位置）显示的一个**小型画布预览窗口**，它始终显示整个画布的缩略图，并在缩略图上标注当前视口的位置。

### 1.2 核心特性

#### 📐 **缩略图显示**
- 显示整个画布的缩小版本（通常缩放比例 1:10 到 1:20）
- 使用独立的 Canvas 渲染，保持性能
- 实时更新，反映画布上所有元素的位置和状态

#### 🎯 **视口指示器**
- 在缩略图上显示一个**半透明矩形框**，表示当前视口（可见区域）
- 矩形框跟随视口移动和缩放实时更新
- 可以使用不同颜色区分（如蓝色边框、半透明填充）

#### 🖱️ **交互功能**
- **点击缩略图**：点击任意位置，主画布视口跳转到该位置
- **拖拽视口框**：直接拖拽缩略图上的视口框，主画布实时跟随移动
- **缩放控制**：在缩略图上滚动鼠标，可以快速缩放画布

### 1.3 视觉设计

```
┌─────────────────────────────────────────┐
│                                         │
│          主画布区域                       │
│                                         │
│                                         │
│                         ┌───────────┐  │
│                         │ 缩略图    │  │
│                         │ ┌───────┐ │  │
│                         │ │视口框 │ │  │
│                         │ └───────┘ │  │
│                         │           │  │
│                         └───────────┘  │
└─────────────────────────────────────────┘
```

### 1.4 实现要点

1. **性能优化**
   - 缩略图渲染频率降低（每 200-300ms 更新一次）
   - 使用离屏 Canvas 缓存渲染结果
   - 元素数量多时，只渲染关键元素（形状、文本、图片）

2. **坐标映射**
   - 需要将画布坐标映射到缩略图坐标
   - 计算当前视口在缩略图中的位置和大小

3. **响应式设计**
   - 缩略图大小可调整（小、中、大三种尺寸）
   - 可以折叠/展开
   - 可以拖拽到任意位置

---

## 🌐 二、画布概览（Canvas Overview）

### 2.1 功能描述

画布概览是一个**全屏或半屏的导航窗口**，提供比缩略图更详细的画布预览，通常通过快捷键（如 `Ctrl+O` 或 `Cmd+O`）打开。

### 2.2 核心特性

#### 📊 **详细预览**
- 显示整个画布的完整内容
- 保持元素的比例和相对位置
- 可以显示元素的基本样式（颜色、形状）

#### 🔍 **缩放滑块**
- 提供缩放控制，可以在概览中调整画布缩放级别
- 实时预览缩放效果

#### 🎯 **视口导航**
- 显示当前视口在画布中的位置（高亮显示）
- 点击概览任意位置，主画布跳转到该位置
- 拖拽视口框，实时移动主画布

#### 📋 **元素列表**
- 可选：显示画布上的所有元素列表
- 点击列表项，跳转到对应元素
- 支持搜索和过滤元素

### 2.3 使用场景

- **大型项目**：当画布内容很多时，快速了解整体布局
- **团队协作**：向团队成员展示项目整体结构
- **快速跳转**：需要快速跳转到画布的某个区域

### 2.4 视觉设计

```
┌─────────────────────────────────────────────────────┐
│  画布概览                          [关闭] [缩放滑块] │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌─────────────────────────────────────────────┐  │
│  │                                             │  │
│  │        整个画布的详细预览                     │  │
│  │                                             │  │
│  │    ┌──────────┐                            │  │
│  │    │ 当前视口 │                            │  │
│  │    │ 区域高亮 │                            │  │
│  │    └──────────┘                            │  │
│  │                                             │  │
│  └─────────────────────────────────────────────┘  │
│                                                     │
│  [元素列表] [搜索框]                                │
└─────────────────────────────────────────────────────┘
```

---

## 🚀 三、快速定位到元素（Quick Element Navigation）

### 3.1 功能描述

快速定位功能帮助用户快速找到并跳转到画布上的特定元素，特别适用于元素数量多、分布广的场景。

### 3.2 核心特性

#### 🔎 **元素搜索面板**
- 通过快捷键（如 `Ctrl+F` 或 `Cmd+F`）打开搜索面板
- 支持按**元素类型**、**文本内容**、**ID** 搜索
- 实时搜索结果高亮显示

#### 📍 **跳转到元素**
- 点击搜索结果，主画布自动**平滑滚动**到该元素位置
- 元素会被**高亮显示**（闪烁或边框高亮）
- 自动调整缩放，确保元素在视口中心可见

#### 🎯 **元素导航**
- **上一个/下一个元素**：快捷键快速切换元素
- **按类型筛选**：只显示特定类型的元素（如所有文本、所有形状）
- **选择列表**：显示所有选中元素，可以快速切换选择

#### 📊 **元素统计**
- 显示画布上元素的总数
- 按类型分类统计（文本、形状、图片等）
- 显示元素分布的热力图（可选）

### 3.3 功能分类

#### 3.3.1 **文字搜索**
```
搜索框输入: "标题"
结果:
  ✓ 文本元素 #123: "标题1" (位置: 100, 200)
  ✓ 形状元素 #456: "标题2" (位置: 300, 400)
```

#### 3.3.2 **类型筛选**
```
筛选: 文本元素
结果:
  - 文本 #1: "项目说明" (100, 50)
  - 文本 #2: "注意事项" (200, 150)
  - 文本 #3: "总结" (300, 250)
```

#### 3.3.3 **元素列表导航**
```
元素列表:
  [📝] 文本: "标题" - 位置 (100, 200)
  [🔷] 矩形: "节点1" - 位置 (300, 400)
  [📷] 图片: "logo.png" - 位置 (500, 600)
  
  [跳转到元素] [选中元素] [删除元素]
```

### 3.4 定位算法

#### **平滑滚动**
```typescript
// 计算元素中心点
const elementCenter = {
  x: element.position.x + element.size.x / 2,
  y: element.position.y + element.size.y / 2
}

// 计算合适的缩放级别（确保元素完全可见）
const padding = 50
const scaleX = viewport.width / (element.size.x + padding * 2)
const scaleY = viewport.height / (element.size.y + padding * 2)
const optimalScale = Math.min(scaleX, scaleY, viewport.scale)

// 平滑移动到元素中心
viewportManager.centerOnPoint(elementCenter)
viewportManager.zoomTo(optimalScale)
```

#### **高亮显示**
```typescript
// 元素高亮动画
function highlightElement(elementId: string) {
  // 1. 添加高亮边框
  // 2. 闪烁动画（3次闪烁）
  // 3. 2秒后自动移除高亮
}
```

---

## 🎯 四、完整功能整合

### 4.1 功能联动

三个功能可以协同工作：

1. **缩略图 + 快速定位**
   - 在快速定位中点击元素 → 缩略图视口框同步移动
   - 在缩略图中拖拽 → 快速定位面板更新当前位置的元素

2. **画布概览 + 元素搜索**
   - 在概览中搜索元素 → 在概览中高亮显示匹配的元素
   - 点击概览中的元素 → 主画布跳转并选中该元素

3. **统一导航栏**
   - 所有导航功能整合到一个导航面板
   - 提供统一的快捷键系统

### 4.2 快捷键方案

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + O` | 打开/关闭画布概览 |
| `Ctrl/Cmd + F` | 打开元素搜索面板 |
| `Ctrl/Cmd + G` | 显示/隐藏缩略图 |
| `F` | 跳转到选中元素 |
| `Ctrl/Cmd + ←/→` | 上一个/下一个元素 |
| `Home` | 跳转到画布原点 |
| `Ctrl/Cmd + 0` | 适合窗口（显示所有元素） |

---

## 🛠️ 五、技术实现要点

### 5.1 缩略图实现

```typescript
class MiniMap {
  private canvas: HTMLCanvasElement
  private ctx: CanvasRenderingContext2D
  private scale: number = 0.1 // 缩略图缩放比例
  
  // 渲染缩略图
  render(engine: CanvasEngine) {
    // 1. 计算画布边界
    const bounds = this.calculateBounds(engine.getElements())
    
    // 2. 设置缩略图尺寸
    this.canvas.width = bounds.width * this.scale
    this.canvas.height = bounds.height * this.scale
    
    // 3. 渲染所有元素（简化版）
    this.renderElements(engine.getElements())
    
    // 4. 绘制视口框
    this.renderViewport(engine.getViewport())
  }
  
  // 处理点击事件
  handleClick(screenPoint: Vector2) {
    const virtualPoint = this.screenToVirtual(screenPoint)
    engine.getViewportManager().centerOnPoint(virtualPoint)
  }
}
```

### 5.2 元素定位实现

```typescript
class ElementNavigator {
  // 查找元素
  searchElements(query: string, filters: SearchFilters) {
    return this.elements.filter(element => {
      // 按文本内容搜索
      if (query && element.data?.text) {
        return element.data.text.includes(query)
      }
      // 按类型筛选
      if (filters.type && element.type !== filters.type) {
        return false
      }
      return true
    })
  }
  
  // 跳转到元素
  navigateToElement(element: CanvasElement) {
    // 1. 计算元素中心
    const center = this.getElementCenter(element)
    
    // 2. 平滑滚动
    this.viewportManager.smoothCenterOnPoint(center)
    
    // 3. 高亮显示
    this.highlightElement(element.id)
    
    // 4. 选中元素
    this.canvasStore.selectElement(element.id)
  }
}
```

### 5.3 性能优化

1. **缩略图渲染优化**
   - 使用 `requestAnimationFrame` 节流
   - 只渲染可见区域附近的元素
   - 使用离屏 Canvas 缓存

2. **搜索优化**
   - 使用索引加速搜索
   - 防抖处理用户输入
   - 虚拟滚动（元素列表很长时）

3. **定位动画**
   - 使用 CSS transition 或动画库
   - 平滑的缓动函数

---

## 📱 六、UI/UX 设计建议

### 6.1 缩略图位置

- **默认位置**：右下角
- **可拖拽**：用户可以移动到任意位置
- **可折叠**：点击最小化按钮，只显示图标

### 6.2 画布概览样式

- **全屏模式**：沉浸式体验
- **半屏模式**：保留主画布可见
- **可调整大小**：拖拽边框调整大小

### 6.3 搜索面板

- **浮窗样式**：不遮挡主画布
- **自动完成**：输入时实时显示匹配结果
- **高亮匹配**：搜索结果中高亮匹配的文字

---

## 🎯 七、使用场景示例

### 场景 1：大型思维导图
```
用户绘制了一个包含 100+ 节点的思维导图
→ 使用缩略图快速了解整体结构
→ 使用搜索功能找到"核心概念"节点
→ 快速跳转并编辑
```

### 场景 2：流程图审查
```
团队成员需要审查一个大型流程图
→ 打开画布概览，查看整体流程
→ 发现某个节点位置不对
→ 点击概览中的节点，主画布跳转
→ 进行修改
```

### 场景 3：元素批量操作
```
用户需要找到所有"待修改"标签的文本元素
→ 打开搜索面板
→ 搜索"待修改"
→ 在结果列表中逐个跳转并修改
```

---

## ✅ 八、实现优先级

### 第一阶段（核心功能）
1. ✅ **缩略图导航** - 最直观的导航工具
2. ✅ **元素搜索和定位** - 快速找到元素

### 第二阶段（增强体验）
3. ✅ **画布概览** - 详细的导航视图
4. ✅ **元素列表** - 结构化导航

### 第三阶段（高级功能）
5. ✅ **元素统计和热力图**
6. ✅ **导航历史记录**
7. ✅ **自定义导航快捷键**

---

## 📝 总结

画布导航系统是一个**提升用户体验**的关键功能，特别适用于：
- ✨ **大型项目**：内容多、面积大的画布
- ✨ **团队协作**：需要快速定位和分享位置
- ✨ **复杂编辑**：需要频繁在不同区域间切换

通过这三个核心功能，用户可以：
- 🎯 始终知道自己在画布的哪个位置
- 🔍 快速找到需要的元素
- 🚀 高效地在画布中导航

---

**建议实现顺序**：先实现缩略图导航（最直观），再实现快速定位（最实用），最后实现画布概览（最完整）。

